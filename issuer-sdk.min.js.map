{"version":3,"file":"issuer-sdk.min.js","sources":["../src/lib/sdk.js"],"sourcesContent":["// JavaScript SDK for Developer API\n// Usage: import sdk from './sdk';\n\nclass IssuerSDK {\n  constructor(apiKey, apiBase = '/api/dev') {\n    this.apiKey = apiKey;\n    this.apiBase = apiBase;\n  }\n\n  setApiKey(apiKey) {\n    this.apiKey = apiKey;\n  }\n\n  setApiBase(apiBase) {\n    this.apiBase = apiBase;\n  }\n\n  // Helper for API requests\n  async _request(method, path, body) {\n    const opts = {\n      method,\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.apiKey}`,\n      },\n    };\n    if (body) opts.body = JSON.stringify(body);\n    const res = await fetch(`${this.apiBase}${path}`, opts);\n    if (!res.ok) throw new Error(await res.text());\n    return res.json();\n  }\n\n  // Credentials\n  async issueCredential(data) {\n    return this._request('POST', '/credentials/issue', data);\n  }\n  async getCredential(id) {\n    return this._request('GET', `/credentials/${id}`);\n  }\n\n  // Payments\n  async sendPayment(data) {\n    return this._request('POST', '/payments/send', data);\n  }\n  async getWalletBalance() {\n    return this._request('GET', '/wallet/balance');\n  }\n\n  // Webhooks\n  async registerWebhook(data) {\n    return this._request('POST', '/webhooks/register', data);\n  }\n  async getWebhooks() {\n    return this._request('GET', '/webhooks');\n  }\n  async getWebhookLogs() {\n    return this._request('GET', '/webhooks/logs');\n  }\n\n  // API Keys\n  async getApiKeys() {\n    return this._request('GET', '/api-keys');\n  }\n  async createApiKey(data) {\n    return this._request('POST', '/api-keys', data);\n  }\n  async revokeApiKey(data) {\n    return this._request('POST', '/api-keys/revoke', data);\n  }\n\n  // Usage\n  async getUsage() {\n    return this._request('GET', '/usage');\n  }\n\n  // Webhook listener (polling)\n  startWebhookPolling(callback, interval = 5000) {\n    if (this._webhookPolling) return;\n    this._webhookPolling = true;\n    let lastTimestamp = null;\n    const poll = async () => {\n      if (!this._webhookPolling) return;\n      try {\n        const logs = await this.getWebhookLogs();\n        // Filter new events by timestamp\n        const newEvents = logs.filter(e => !lastTimestamp || new Date(e.timestamp) > new Date(lastTimestamp));\n        if (newEvents.length > 0) {\n          lastTimestamp = newEvents[newEvents.length - 1].timestamp;\n          newEvents.forEach(callback);\n        }\n      } catch (e) {\n        // Optionally handle error\n      }\n      if (this._webhookPolling) {\n        this._webhookPollingTimeout = setTimeout(poll, interval);\n      }\n    };\n    poll();\n  }\n\n  stopWebhookPolling() {\n    this._webhookPolling = false;\n    if (this._webhookPollingTimeout) {\n      clearTimeout(this._webhookPollingTimeout);\n      this._webhookPollingTimeout = null;\n    }\n  }\n\n  onWebhook(callback, interval) {\n    this.startWebhookPolling(callback, interval);\n  }\n}\n\nconst sdk = {\n  IssuerSDK,\n};\n\nif (typeof window !== 'undefined') {\n  window.sdk = sdk;\n} "],"names":[],"mappings":"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"}